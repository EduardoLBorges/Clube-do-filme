<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ filme[0] }} â€“ Clube do Filme</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
  <h1>{{ filme[0] }}</h1>

<div class="filme-grid">
  <div class="poster-container">
    <img src="{{ filme[1] }}" class="poster" alt="Poster do Filme">
  </div>

  <form class="formulario" method="post">
    <label>Seu nome:</label>
    <input name="nome" placeholder="Digite seu nome" required>

    {% for campo in ['roteiro', 'atuacao', 'direcao', 'fotografia', 'trilha', 'montagem', 'impacto'] %}
      <div class="estrelas-box">
        <div class="categoria">
          <label>{{ campo.capitalize() }}:</label>
        </div>
        
        <div class="estrelas" data-name="{{ campo }}">
          {% for i in range(1, 6) %}
            <span class="estrela" data-value="{{ i }}">&#9733;</span>
          {% endfor %}
        </div>
        <input type="hidden" name="{{ campo }}" required>
      </div>
    {% endfor %}

    <label>CrÃ­tica:</label>
    <textarea name="critica" placeholder="Escreva sua opiniÃ£o..." required></textarea>

    <button type="submit">Enviar AvaliaÃ§Ã£o</button>
  </form>
</div>

<h2>AvaliaÃ§Ãµes Recentes</h2>
<div class="avaliacoes-grid">
  {% for a in avaliacoes %}
    <div class="avaliacao">
      <strong>{{ a[1] }}</strong> em {{ a[-2].strftime('%d/%m/%Y %H:%M') }}:
      <form id="cx-excluir" method="post" action="{{ url_for('excluir', id=a[0]) }}" onsubmit="return confirm('Tem certeza que deseja excluir esta avaliaÃ§Ã£o?')">
        <button class="btn-excluir">ğŸ—‘ï¸</button>
      </form>
      <ul>
        <li>ğŸï¸ Roteiro: {{ a[2] }}</li>
        <li>ğŸ­ AtuaÃ§Ã£o: {{ a[3] }}</li>
        <li>ğŸ¬ DireÃ§Ã£o: {{ a[4] }}</li>
        <li>ğŸ“· Fotografia: {{ a[5] }}</li>
        <li>ğŸ¶ Trilha: {{ a[6] }}</li>
        <li>âœ‚ï¸ Montagem: {{ a[7] }}</li>
        <li>ğŸ’¥ Impacto: {{ a[8] }}</li>
      </ul>
      <p><em>{{ a[9] }}</em></p>
    </div>
  {% endfor %}
</div>

  <p><a href="{{ url_for('home') }}">â† Voltar Ã  lista de filmes</a></p>

<script>
  document.querySelectorAll('.estrelas').forEach(estrelasBox => {
    const estrelas = estrelasBox.querySelectorAll('.estrela');
    const hiddenInput = estrelasBox.nextElementSibling;

    estrelas.forEach(estrela => {
      estrela.addEventListener('click', () => {
        const valor = parseInt(estrela.getAttribute('data-value'));
        hiddenInput.value = valor;

        estrelas.forEach(e => {
          e.classList.toggle('ativa', parseInt(e.getAttribute('data-value')) <= valor);
        });
      });
    });
  });
</script>
</body>
</html>
